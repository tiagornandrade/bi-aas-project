.PHONY: venv
venv:
	@echo "üîß Criando ambiente virtual..."
	@python3 -m venv venv
	@echo "‚úÖ Ambiente virtual criado!"

.PHONY: install
install: venv
	@echo "üì¶ Instalando depend√™ncias..."
	@source venv/bin/activate && pip install --upgrade pip
	@source venv/bin/activate && pip install -r requirements.txt
	@echo "‚úÖ Depend√™ncias instaladas!"

.PHONY: run
run:
	@echo "üöÄ Iniciando Superset..."
	@docker exec -it superset superset run -p 8088 --host 0.0.0.0 --with-threads

.PHONY: test
test:
	@echo "üß™ Executando testes..."
	@source venv/bin/activate && pytest -vv --junitxml=test-results-database.xml

.PHONY: up
up:
	@echo "‚¨ÜÔ∏è Iniciando os servi√ßos (Superset, PostgreSQL, Redis, Celery)..."
	@docker-compose -f docker-compose.yml up -d
	@echo "‚úÖ Servi√ßos iniciados!"

.PHONY: down
down:
	@echo "‚¨áÔ∏è Parando os servi√ßos..."
	@docker-compose down
	@echo "‚úÖ Servi√ßos parados!"

.PHONY: restart
restart:
	@echo "üîÑ Reiniciando os servi√ßos..."
	@docker-compose restart
	@echo "‚úÖ Servi√ßos reiniciados!"

.PHONY: setup
setup: up
	@echo "‚öôÔ∏è  Configurando Superset..."
	@docker exec -it superset superset db upgrade
	@docker exec -it superset superset init
	@docker exec -it superset superset fab create-admin \
		--username admin \
		--firstname Superset \
		--lastname Admin \
		--email admin@localhost \
		--password admin
	@echo "‚úÖ Superset configurado!"

.PHONY: logs
logs:
	@echo "üìú Exibindo logs do Superset..."
	@docker-compose logs -f superset

.PHONY: clean
clean:
	@echo "üóëÔ∏è Removendo arquivos tempor√°rios..."
	@rm -rf venv __pycache__ .pytest_cache
	@echo "‚úÖ Limpeza conclu√≠da!"

.PHONY: help
help:
	@echo "üìñ Comandos dispon√≠veis:"
	@echo "  make venv            -> Criar ambiente virtual"
	@echo "  make install         -> Instalar depend√™ncias"
	@echo "  make run             -> Rodar Superset localmente"
	@echo "  make test            -> Executar testes"
	@echo "  make up              -> Subir servi√ßos com Docker Compose"
	@echo "  make down            -> Parar servi√ßos com Docker Compose"
	@echo "  make restart         -> Reiniciar servi√ßos com Docker Compose"
	@echo "  make setup           -> Configurar Superset"
	@echo "  make logs            -> Ver logs do Superset"
	@echo "  make clean           -> Limpar arquivos tempor√°rios"
