PROJECT_NAME = cyber-gen
STACK_NAME = dev

PULUMI_STACK = $(PROJECT_NAME)-$(STACK_NAME)

.PHONY: install
install:
	@echo "ðŸ“¦ Instalando dependÃªncias..."
	@pip install -r requirements.txt
	@echo "âœ… DependÃªncias instaladas!"

.PHONY: init
init:
	@echo "ðŸ”§ Inicializando o Pulumi..."
	@pulumi stack init $(PULUMI_STACK) || echo "Stack jÃ¡ existe"
	@pulumi config set project_id $(PROJECT_ID)
	@pulumi config set region $(REGION)
	@pulumi config set db_name $(DB_NAME)
	@pulumi config set db_user $(DB_USER)
	@pulumi config set db_password $(DB_PASSWORD) --secret
	@echo "âœ… Pulumi configurado!"

.PHONY: up
up:
	@echo "ðŸš€ Criando a infraestrutura..."
	@pulumi up
	@echo "âœ… Infraestrutura provisionada!"

.PHONY: destroy
destroy:
	@echo "ðŸ”¥ Removendo a infraestrutura..."
	@pulumi destroy
	@pulumi stack rm || echo "Stack jÃ¡ removido"
	@echo "âœ… Infraestrutura destruÃ­da!"

.PHONY: refresh
refresh:
	@echo "ðŸ”„ Atualizando a infraestrutura..."
	@pulumi refresh
	@echo "âœ… Infraestrutura atualizada!"

.PHONY: help
help:
	@echo "ðŸ“š Comandos disponÃ­veis:"
	@echo " make install		-> Instala as dependÃªncias do projeto"
	@echo " make init			-> Inicializa o Pulumi"
	@echo " make up				-> Cria a infraestrutura"
	@echo " make destroy		-> Remove a infraestrutura"
	@echo " make help			-> Exibe esta mensagem de ajuda"


# psql "host=/cloudsql/yams-lab-nonprod:us-central1:cyber-gen-db dbname=cybergen user=biaas password=SenhaSegura123"

# gcloud sql instances patch cyber-gen-db --authorized-networks=$(curl -4 -s ifconfig.me)/32
